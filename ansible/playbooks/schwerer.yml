---
# Hauptplaybook f√ºr Host "schwerer"
# Entspricht der NixOS-Konfiguration unter nixos/hosts/schwerer/

- name: Configure workstation "schwerer"
  hosts: schwerer
  become: true

  pre_tasks:
    - name: Detect distribution
      ansible.builtin.setup:
        filter: ansible_distribution*

    - name: Display target system info
      ansible.builtin.debug:
        msg: |
          Target: {{ inventory_hostname }}
          Distribution: {{ ansible_distribution }} {{ ansible_distribution_version }}
          Architecture: {{ ansible_architecture }}

  roles:
    # Basis-System (Locale, Pakete, SSH, Firewall)
    - role: base
      tags: [base, always]

    # User-Setup
    - role: user
      tags: [user]

    # NVIDIA Treiber (vor Desktop)
    - role: nvidia
      when: enable_nvidia | default(false)
      tags: [nvidia, drivers]

    # Desktop-Umgebung Basis (GDM, Printing, Audio)
    - role: desktop
      tags: [desktop]

    # GNOME Desktop
    - role: gnome
      when: enable_gnome | default(false)
      tags: [gnome, desktop]

    # Hyprland (Wayland WM)
    - role: hyprland
      when: enable_hyprland | default(false)
      tags: [hyprland, desktop]

    # Gaming (Steam, Emulators, Controller)
    - role: gaming
      when: enable_gaming | default(false)
      tags: [gaming]

    # Dotfiles verlinken (als letztes)
    - role: dotfiles
      tags: [dotfiles]

  post_tasks:
    - name: Final message
      ansible.builtin.debug:
        msg: |
          ========================================
          Configuration complete for {{ inventory_hostname }}!

          Next steps:
          - Reboot if kernel/drivers were updated
          - Log in as {{ main_user }}
          - Dotfiles are linked from {{ dotfiles_dir }}
          ========================================
