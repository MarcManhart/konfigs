---
# CUPS Printing Setup

- name: Install CUPS packages (Arch)
  when: ansible_distribution == "Archlinux"
  community.general.pacman:
    name:
      - cups
      - cups-pdf
      - gutenprint
      - hplip
    state: present

- name: Install CUPS packages (Debian/Ubuntu)
  when: ansible_os_family == "Debian"
  ansible.builtin.apt:
    name:
      - cups
      - cups-pdf
      - printer-driver-gutenprint
      - hplip
    state: present

- name: Install CUPS packages (Fedora)
  when: ansible_distribution == "Fedora"
  ansible.builtin.dnf:
    name:
      - cups
      - cups-pdf
      - gutenprint
      - hplip
    state: present

- name: Enable CUPS service
  ansible.builtin.systemd:
    name: cups
    enabled: true
    state: started

# Avahi f√ºr Netzwerkdrucker-Erkennung
- name: Install Avahi
  ansible.builtin.package:
    name: "{{ 'avahi' if ansible_distribution == 'Archlinux' else 'avahi-daemon' }}"
    state: present

- name: Enable Avahi
  ansible.builtin.systemd:
    name: avahi-daemon
    enabled: true
    state: started

- name: Add user to lpadmin group
  ansible.builtin.user:
    name: "{{ main_user }}"
    groups: ["{{ 'sys' if ansible_distribution == 'Archlinux' else 'lpadmin' }}"]
    append: true
